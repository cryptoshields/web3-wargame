<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Approve & Pray — Web3 War Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script> <!-- Added ethers library -->
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0c0c1d;
      color: #fff;
    }
    #mobile-warning {
      display: none;
      padding: 2rem;
      text-align: center;
      font-size: 1.2rem;
      background: #0c0c1d;
    }
    #main-content {
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 2rem;
      position: relative;
    }
    .glow {
      position: absolute;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(0,255,255,0.2), transparent 70%);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      filter: blur(80px);
      z-index: 0;
    }
    .content-box {
      max-width: 640px;
      width: 100%;
      z-index: 1;
      text-align: center;
      background: rgba(0, 0, 0, 0.6);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .logo {
      font-size: 2.5rem;
      font-weight: bold;
      color: #ff9800;
      margin-bottom: 0.5rem;
    }
    .tagline {
      font-size: 1.1rem;
      color: #ccc;
      margin-bottom: 2rem;
    }
    .button {
      display: inline-block;
      background: #ff9800;
      color: #fff;
      padding: 1rem 2rem;
      border-radius: 8px;
      font-size: 1rem;
      text-decoration: none;
      margin: 0.5rem;
    }
    .menu {
      margin: 2rem 0;
      text-align: left;
    }
    .menu p {
      margin: 0.3rem 0;
    }
    .meta-section {
      font-size: 0.95rem;
      line-height: 1.6;
      text-align: left;
      margin-top: 2rem;
    }
    .meta-section h3 {
      margin: 1rem 0 0.5rem;
    }
    a {
      color: #00e6ff;
    }
    button {
      background: #1e88e5;
      border: none;
      color: white;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    @media (max-width: 768px) {
      #main-content {
        display: none;
      }
      #mobile-warning {
        display: block;
      }
    }
  </style>
</head>
<body>
  <div id="mobile-warning">
    🚫 <strong>This simulation is not supported on mobile devices.</strong><br><br>
    Please use a desktop or laptop with the MetaMask extension installed.<br><br>
    ⚠️ This project is for <strong>educational purposes only</strong>. Do not use your real wallet.<br><br>
    Stay safe. Stay sharp. See you on desktop.
  </div>

  <div id="main-content">
    <div class="glow"></div>
    <div class="content-box">
      <div class="logo">🛡️ Approve & Pray</div>
      <div class="tagline">A game of scams, signatures, and survival.</div>

      <a href="level1.html" class="button">▶️ Start Game</a>
      <a href="leaderboard.html" class="button">📜 Leaderboard</a>
      <a href="learn.html" class="button">🧠 Learn Before You Sign</a>
      <button id="mintTokenBtn" disabled>Mint Fake Token</button>

      <div class="menu">
        <p>🧪 Level 1: Approve Trap</p>
        <p>🎭 Level 2: setApprovalForAll</p>
        <p>🖊️ Level 3: Permit2</p>
        <p>🔗 Level 4: delegatecall</p>
        <p>🎲 Level 5: ???</p>
      </div>

      <div class="meta-section">
        <h3>🚧 Testnet Only</h3>
        <p>This game runs on the <strong>Sepolia testnet</strong>. Use a burner wallet with test ETH only.</p>

        <h3>🧪 Need Sepolia ETH?</h3>
        <p>Get it here:<br>
          <a href="https://sepoliafaucet.com" target="_blank">https://sepoliafaucet.com</a>
        </p>

        <h3>🔧 Switch to Sepolia</h3>
        <button onclick="switchToSepolia()">Switch to Sepolia</button>

        <h3>🛠️ Add Sepolia Manually</h3>
        <p>Chain ID: <strong>11155111</strong><br>
           RPC URL: <strong>https://rpc.sepolia.org</strong><br>
           Currency: <strong>SepoliaETH</strong><br>
           Explorer: <strong>https://sepolia.etherscan.io</strong>
        </p>
      </div>
    </div>
  </div>

  <script>
    async function switchToSepolia() {
      try {
        await window.ethereum.request({
          method: 'wallet_switchEthereumChain',
          params: [{ chainId: '0xaa36a7' }]
        });
      } catch (switchError) {
        console.warn("Could not switch network:", switchError);
      }
    }

    let provider, signer, token, userAddress;

    // Initialize token contract
    const tokenAddress = "0x2ae3f821fdBad3Fe6A5A84111c4D19E0a2fb0Ed5"; // WG_FakeToken address
    const tokenABI = [
      "function approve(address spender, uint256 amount) public returns (bool)",
      "function allowance(address owner, address spender) public view returns (uint256)",
      "function balanceOf(address account) public view returns (uint256)",
      "function transferFrom(address from, address to, uint256 amount) public returns (bool)",
      "function faucet() external"
    ];

    async function connectWallet() {
      if (!window.ethereum) {
        alert("Please install MetaMask.");
        return;
      }
      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        userAddress = await signer.getAddress();
        token = new ethers.Contract(tokenAddress, tokenABI, signer);

        const network = await provider.getNetwork();
        if (network.chainId !== 11155111) {
          document.getElementById("mintTokenBtn").disabled = true;
          alert("Please switch to Sepolia testnet.");
          return;
        }

        document.getElementById("mintTokenBtn").disabled = false;
        console.log("Connected:", userAddress);
      } catch (err) {
        console.error("Connection error:", err);
        document.getElementById("mintTokenBtn").disabled = true;
      }
    }

    document.getElementById("mintTokenBtn").onclick = async () => {
      if (!signer || !token) {
        alert("Please connect your wallet first.");
        return;
      }

      try {
        const tx = await token.faucet({ gasLimit: 100000 });
        console.log("Mint tx hash:", tx.hash);
        await tx.wait();
        const balance = await token.balanceOf(userAddress);
        alert(`Successfully minted tokens! New balance: ${ethers.utils.formatEther(balance)} WGFAKE`);
      } catch (err) {
        console.error("Mint error:", err);
        alert(`Failed to mint tokens: ${err.reason || err.message || "Try again."}`);
      }
    };

    // Connect wallet when page loads or MetaMask changes
    window.onload = () => {
      if (window.ethereum) {
        connectWallet();
        window.ethereum.on("chainChanged", () => connectWallet());
        window.ethereum.on("accountsChanged", () => connectWallet());
      }
    };
  </script>
</body>
</html>
