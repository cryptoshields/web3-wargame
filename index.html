<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>WarGame Level 1 - Approve Challenge</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; text-align: center; padding: 2rem; }
    button { padding: 1rem 2rem; margin: 1rem; font-size: 1.1rem; background: #26a69a; border: none; color: #fff; cursor: pointer; }
    .danger { background: #e74c3c; }
    .safe { background: #2ecc71; }
    .attack { background: #f39c12; }
    #status { margin-top: 2rem; font-size: 1.2rem; }
  </style>
</head>
<body>
  <h1>âš”ï¸ WarGame Level 1: Approve or Be Drained</h1>
  <p>You're about to claim your fake reward. Will you survive?</p>
  
  <button id="connectBtn">ğŸ”Œ Connect Wallet</button>
  <button id="approveBtn" class="danger">ğŸ Claim Reward (Unsafe)</button>
  <button id="drainBtn" class="attack">ğŸ’€ Drain Me</button>
  <button id="surviveBtn" class="safe">ğŸ§  Avoid Trap (Safe Choice)</button>
  
  <div id="status"></div>

  <script type="text/javascript">
    const tokenAddress = "0xe9AcD45E928E815D1c79a4A37D144Dc379F15de7"; // WGFAKE
    const attackerContract = "0xE717C074edf0eacf9f318043553726411864C731"; // w3game

    const tokenABI = [
      "function approve(address spender, uint256 amount) public returns (bool)"
    ];
    
    const attackerABI = [
      "function drain(address token, address victim) external"
    ];

    let provider, signer, token, attackContract, userAddress;

    document.getElementById("connectBtn").onclick = async () => {
      try {
        if (!window.ethereum) throw new Error("MetaMask not installed");
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();
        userAddress = await signer.getAddress();
        token = new ethers.Contract(tokenAddress, tokenABI, signer);
        attackContract = new ethers.Contract(attackerContract, attackerABI, signer);
        document.getElementById("status").innerText = "âœ… Wallet connected! Ready to claim reward.";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "âŒ Failed to connect wallet.";
      }
    };

    document.getElementById("approveBtn").onclick = async () => {
      if (!signer) return alert("Connect your wallet first.");
      try {
        const tx = await token.approve(attackerContract, ethers.parseUnits("1000", 18));
        await tx.wait();
        document.getElementById("status").innerText = "âš ï¸ Approved malicious spender. You are vulnerable.";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "âŒ Approval failed.";
      }
    };

    document.getElementById("drainBtn").onclick = async () => {
      if (!signer) return alert("Connect your wallet first.");
      try {
        const tx = await attackContract.drain(tokenAddress, userAddress);
        await tx.wait();
        document.getElementById("status").innerText = "ğŸ’€ Youâ€™ve been drained! Game over (simulated).";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "âŒ Drain failed (maybe not approved).";
      }
    };

    document.getElementById("surviveBtn").onclick = () => {
      document.getElementById("status").innerText = "ğŸ§  You avoided the trap. Proceed to next level!";
      document.getElementById("approveBtn").disabled = true;
      document.getElementById("drainBtn").disabled = true;
    };
  </script>
</body>
</html>
